<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patch Planning + Heartbleed + v0.2.1 &mdash; Spark Blog</title>
    <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://spark.github.io/staging-blog/assets/main.css">
    <link rel="shortcut icon" href="http://spark.github.io/staging-blog/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="http://spark.github.io/staging-blog/images/logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="Spark Blog" />
    <meta name="title" content="Patch Planning + Heartbleed + v0.2.1 ">
    <link rel="canonical" href="http://spark.github.io/staging-blog/2014/04/24/patch-planning-heartbleed-and-v0.2.1/">
    
    
    <meta property="og:title" content="Patch Planning + Heartbleed + v0.2.1 "/>
    <meta property="og:url" content="http://spark.github.io/staging-blog/2014/04/24/patch-planning-heartbleed-and-v0.2.1/"/>
    
    <meta property="og:image" content="http://spark.github.io/staging-blog/images/blog-cover.jpg"/>
    
    <meta property="og:image" content="http://spark.github.io/staging-blog/images/logo.png"/>
    
    
    <meta property="og:description" content="The cloud team goes into the war room to prep for TI's release, and Heartbleed helps us learn about certificates."/>
    <meta name="description" content="The cloud team goes into the war room to prep for TI's release, and Heartbleed helps us learn about certificates."/>
    
    <meta property="og:site_name" content="Spark Blog">
</head>
<body>

<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="https://www.spark.io/">
                <img src="http://spark.github.io/staging-blog/images/logo.png" alt="Inc">
            </a>
            <a href="http://spark.github.io/staging-blog" class="home">Blog</a>
            <a href="https://store.spark.io/">Product</a>
            
        </nav>
        <nav class="tagline">
            <span>Wi-Fi for Everything</span>
            <a href="https://store.spark.io/" class="btn btn-outline">Buy Now</a>
        </nav>
    </header>
</section>


<div class="article-cover">
    <div>
        <img src="http://spark.github.io/staging-blog/images/blog-cover.jpg" class="image">
    </div>
</div>

<article>

    <div class="container">
        <header>
            <div class="meta">
                By <address><a rel="author" href="" title="Zachary Crockett" target="_blank">Zachary Crockett</a> &mdash;
                <time pubdate datetime="2014-24-April" title="April 24, 2014">April 24, 2014</time>
            </div>
            <h1 class="title">Patch Planning + Heartbleed + v0.2.1</h1>
            
        </header>

        <section>
            <h2>CC3000 patch deployment planning</h2>

<p>The cloud team went into the war room during sprint 9, grabbed dry erase markers,
and started scribbling on everything.
Texas Instruments is finishing the quality assurance testing on the CFOD patch,
and it should be released very soon.
We needed to figure out how to deploy it, safely and as seamlessly as possible,
to as many users as possible, including those who don&#39;t even know what CFOD is.
Here&#39;s what we figured out.</p>

<ul>
<li>We&#39;ll create a new &quot;deep update&quot; feature in the web IDE that we can reuse for similar situations in the future.</li>
<li>The update will be opt-in, with users specifically clicking a button in the web IDE to view instructions and perform the patch.</li>
<li>For Cores that currently perform over-the-air updates reliably, the patch will happen wirelessly and seamlessly.
The process will require some patience, but it should be happily automagical.</li>
<li>There will also be a download + local USB patching option using <code>dfu-util</code> and the Spark CLI.</li>
<li>We can&#39;t yet boot the Core back into the previous firmware, so the <em>Core will be running Tinker</em> after patching is finished.</li>
</ul>

<p>To be clear, we don&#39;t have a finalized patch from TI, but we&#39;re getting ready anyway.
We hope to be ready to deploy a patch by the end of sprint 10 (May 2),
though the web IDE front end changes are complex enough that
they will probably bleed into sprint 11.
Speaking of blood...</p>

<h2>Heartbleed mitigation</h2>

<p>So, if you haven&#39;t heard, it turns out there was an enormous, gaping hole in the
security systems of basically the entire internet for the past couple years,
<a href="http://xkcd.com/1354/">because bounds-checking</a>.
Some smart people saw it, felt a moment of dread/wide-eyed panic, patched it,
gave it a catchy name, a nice icon, a
<a href="http://heartbleed.com/">pretty website</a>,
and tried to spread the word as fast as they could.</p>

<div class="full"><img src="http://spark.github.io/staging-blog/images/heartbleed.png"></div>

<p>As soon as we heard on April 8, we started patching our systems,
and by that afternoon all Spark servers were no longer vulnerable.
During that part of the process, we upgraded OpenSSL to safe versions on all our servers,
especially the web-facing ones like api.spark.io and community.spark.io.</p>

<p>Then began the certificate dance.
Since OpenSSL has been vulnerable for years, we have to assume our TLS certificate keys
are compromised even though we have no evidence of an attack.</p>

<p>Many teams who manage servers, Spark included,
took this opportunity to try to level up the security standards.
On April 10th, we tried rotating the community certificate to one using an ECDSA key
for its cutting edge protections including mandatory forward secrecy.
However, we found many users&#39; systems were incompatible with the new certificate,
so we quickly rolled back to the old certificate.
Lesson learned!</p>

<p>After some painfully slow back and forth with Comodo, our certificate authority,
(during which process we helped them identify a bug in their automated certificate generation systems)
they finally issued us a working certificate on April 21.
The new certificate has now been deployed to all Spark web servers and load balancers,
and the old certificates have been revoked.</p>

<h2>Firmware version 0.2.1</h2>

<p>We deployed the latest and greatest firmware to the web IDE.
The tagged stable release is downloadable from the
<a href="https://github.com/spark/core-firmware/releases">core-firmware releases</a>
page on GitHub.
You&#39;ll see commit links in the settings drawer if you click to expand the version.</p>

<div class="full"><img src="http://spark.github.io/staging-blog/images/v0.2.1.png"/></div>

<p>There were also some sweet features added to the Sparkulator itself.
My favorite? You can now download your compiled binaries and flash them over USB.
This complements the Spark CLI cloud compile feature to add an additional option
for those seeking a middle ground between coding, compiling, and flashing
<em>completely</em> in the cloud versus <em>completely</em> locally.</p>

<div class="full"><img src="http://spark.github.io/staging-blog/images/download-firmware-binary.png"/></div>

<p>Highlighted changes from v0.2.0 to v0.2.1:</p>

<ul>
<li>OTA reliability improvements
(<a href="https://github.com/spark/core-firmware/pull/155">core-firmware</a>,
<a href="https://github.com/spark/core-common-lib/pull/19">core-common-lib</a>,
<a href="https://github.com/spark/core-communication-lib/pull/8">core-communication-lib</a>)</li>
<li>Allow Spark.publish inside Spark.function
(<a href="https://github.com/spark/core-communication-lib/pull/13">core-communication-lib</a>)</li>
<li>Add Network.ping() (<a href="https://github.com/spark/core-firmware/pull/156">core-firmware</a>)</li>
<li>Enable factory reset from firmware (only on new bootloader)
(<a href="https://github.com/spark/core-common-lib/pull/21">core-common-lib</a>,
<a href="https://github.com/spark/bootloader/pull/9">bootloader</a>)</li>
</ul>

<p>Version 0.2.1 is being programmed on the current manufacturing run.</p>

<p>And lastly, speaking of manufacturing...</p>

<h2>The Stealth Core</h2>

<p>Shhh... I&#39;ve got a secret...</p>

<p>Promise not to tell?</p>

<p>So hawt...</p>

<p>Are you ready?</p>

<p>Check this out:</p>

<div class="full"><img src="http://spark.github.io/staging-blog/images/stealth-core.jpg"></div>

<h3>BOOM.</h3>

<p>Starting next week, we&#39;ll be shipping out thousands of new Spark Cores to our anxiously awaiting customers! We&#39;ll finally have Cores in stock, so hopefully you&#39;ll never have to wait for a Core again!</p>

<p>This time around, the Cores (codename: <strong>Stealth Core</strong>) will be black. But don&#39;t worry - <em>nothing has changed other than the color.</em> The black Cores are identical to the previous white Cores, except they&#39;re black.</p>

<p>How come we changed the color? It&#39;s a long complicated story that gets way into the bowels of the supply chain, but basically, it turns out that white boards are difficult to manufacture, and our PCB fab house didn&#39;t want to make them anymore. For the near term, Spark Cores will be black - call it a Special Editionâ„¢ - and long term we&#39;re exploring some new custom color options so that we can make our boards look truly distinctive.</p>

<p>We&#39;ll let you know when Cores are shipping, and if you&#39;ve got one on order, we hope you enjoy the new color!</p>

            
<div class="social">
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Patch Planning + Heartbleed + v0.2.1" data-related="spark_io">Tweet</a>
    </div>
    
    
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
    
    
    
    
    <div>
        <a href="http://news.ycombinator.com/submit" class="hn-share-button">Vote on HN</a>
    </div>
    
</div>

        </section>

        <footer>
            <address>
               <img src="http://spark.github.io/staging-blog/images/zachary.jpg">
                <p>Written by <strong><a rel="author" href="https://twitter.com/towynlin" title="" target="_blank">Zachary Crockett</a></strong><br>
                <span class="muted">Founder, CTO</span>
                </p>
            </address>

        </footer>

        
    </div>
</article>


<footer class="site-footer">
    <div class="container">
        &copy; 2015

        <nav>
            <a href="https://www.spark.io/">Spark IO</a> &middot;
            <a href="http://spark.github.io/staging-blog">Blog</a> &middot;
            <a href="https://store.spark.io/">Product</a> &middot; 
            
        </nav>

        <nav class="social">
            
            <a href="https://twitter.com/spark_io" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/sparkdevices" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
            
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://spark.github.io/staging-blog/assets/appear.js"></script>
<script src="http://spark.github.io/staging-blog/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<script>
    (function(d, t) {
        var g = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = '//hnbutton.appspot.com/static/hn.min.js';
        s.parentNode.insertBefore(g, s);
    }(document, 'script'));
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-37038200-4', 'http://spark.github.io/staging-blog');
  ga('send', 'pageview');
</script>

</body>
</html>
